import{a as B,M as z,N as Q,h as D,k as N,m as h,d as L,e as E,j,q as P,t as T,D as G,_ as S,F as o,O as c,K as p,P as R,E as M,L as u,Q as b,R as $,G as k,S as W,I as i,T as v,H as y,U as V,V as I,W as U,A as F,w as O,X as H,Y as _,Z as K,$ as x}from"./index.8f04df74.js";const A='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var Y=B({name:"QSpinnerDots",props:z,setup(e){const{cSize:t,classes:s}=Q(e);return()=>D("svg",{class:s.value,fill:"currentColor",width:t.value,height:t.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:A})}}),X=B({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:t}){const{proxy:{$q:s}}=j(),l=N(P,h);if(l===h)return console.error("QPage needs to be a deep child of QLayout"),h;if(N(T,h)===h)return console.error("QPage needs to be child of QPageContainer"),h;const m=L(()=>{const n=(l.header.space===!0?l.header.size:0)+(l.footer.space===!0?l.footer.size:0);if(typeof e.styleFn=="function"){const r=l.isContainer.value===!0?l.containerHeight.value:s.screen.height;return e.styleFn(n,r)}return{minHeight:l.isContainer.value===!0?l.containerHeight.value-n+"px":s.screen.height===0?n!==0?`calc(100vh - ${n}px)`:"100vh":s.screen.height-n+"px"}}),a=L(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>D("main",{class:a.value,style:m.value},E(t.default))}});const Z=G({name:"GameCell",emits:["click"],props:{originalValue:{type:Number,required:!0},userValue:{type:Number,required:!0},isWrong:{type:Boolean,default:!0},isSelected:{type:Boolean,default:!1},isRowStart:{type:Boolean,default:!1},isRowEnd:{type:Boolean,default:!1},isColStart:{type:Boolean,default:!1},isColEnd:{type:Boolean,default:!1}},computed:{isConstant(){return this.originalValue!==0},displayValue(){const e=this.originalValue>0?this.originalValue:this.userValue;return e>0?e.toString():""}}});function J(e,t,s,l,d,m){return o(),c("div",{class:R(["cell",{"row-start":e.isRowStart,"row-end":e.isRowEnd,"col-start":e.isColStart,"col-end":e.isColEnd,constant:e.isConstant,selected:e.isSelected,wrong:e.isWrong}]),onClick:t[0]||(t[0]=a=>e.$emit("click"))},p(e.displayValue),3)}var ee=S(Z,[["render",J],["__scopeId","data-v-68f95463"]]);const te=G({name:"GameBoard",components:{GameCell:ee},emits:["cell-click"],props:{board:{type:Object,required:!0},solution:{type:Object,required:!0},userValues:{type:Object,required:!0},selectedCell:{type:Number,default:void 0}},computed:{selectedCellRow(){if(this.selectedCell!==void 0)return Math.floor(this.selectedCell/this.board.size)+1},selectedCellCol(){if(this.selectedCell!==void 0)return this.selectedCell%this.board.size+1}},methods:{getCellIndex(e,t){return(t-1)*this.board.size+(e-1)},getSkeletonValue(e,t){const s=this.getCellIndex(e,t);return this.solution.skeleton[s]},getUserValue(e,t){const s=this.getCellIndex(e,t);return this.userValues[s]},getIsWrong(e,t){const s=this.getCellIndex(e,t);if(this.solution.skeleton[s]!==0||this.userValues[s]===0)return!1;const l=this.userValues[s],d=this.solution.solution[s];return l!==d},onClickCell(e,t){this.$emit("cell-click",{idx:this.getCellIndex(e,t)})},getCellSegmentFlags(e,t){const s=this.board.rows[t-1],l=this.board.columns[e-1];let d=!1,m=!1,a=!1,n=!1,r=0;for(const f of s)e-1===r&&(d=!0),r+=f-1,e-1===r&&(m=!0),r+=1;r=0;for(const f of l)t-1===r&&(a=!0),r+=f-1,t-1===r&&(n=!0),r+=1;return{isRowStart:d,isRowEnd:m,isColStart:a,isColEnd:n}}}}),se={class:"flex column"},le={class:"game-board"};function ae(e,t,s,l,d,m){const a=M("game-cell");return o(),c("div",se,[u("div",le,[(o(!0),c(b,null,$(e.board.size,n=>(o(),c("div",{key:n,class:"board-row"},[(o(!0),c(b,null,$(e.board.size,r=>(o(),k(a,W({key:r,originalValue:e.getSkeletonValue(r,n),userValue:e.getUserValue(r,n)},{ref_for:!0},e.getCellSegmentFlags(r,n),{onClick:()=>e.onClickCell(r,n),isSelected:r===e.selectedCellCol&&n===e.selectedCellRow,isWrong:e.getIsWrong(r,n)}),null,16,["originalValue","userValue","onClick","isSelected","isWrong"]))),128))]))),128))])])}var re=S(te,[["render",ae],["__scopeId","data-v-25f7d2a0"]]);const ne=G({name:"GameKeyboard",props:{size:{type:Number,required:!0}},emits:["number-click","undo-click","menu-click"],setup(e,{emit:t}){return{onNumberClick:l=>{t("number-click",{value:l,notesMode:!1})}}}}),ie={class:"game-keyboard column items-center justify-center q-pa-xs q-gutter-y-sm"},oe={class:"row no-wrap q-gutter-xs justify-center"},ue={class:"q-gutter-x-sm justify-center q-ml-sm"};function de(e,t,s,l,d,m){return o(),c("div",ie,[u("div",oe,[(o(!0),c(b,null,$(e.size,a=>(o(),k(v,{key:a,label:a,onClick:n=>e.onNumberClick(a),flat:"",dense:"",class:"number-btn"},null,8,["label","onClick"]))),128))]),u("div",ue,[i(v,{icon:"close",onClick:t[0]||(t[0]=a=>e.onNumberClick(0)),flat:"",dense:"",class:"action-btn"}),i(v,{icon:"undo",flat:"",dense:"",onClick:t[1]||(t[1]=a=>e.$emit("undo-click")),class:"action-btn"}),i(v,{icon:"menu",flat:"",dense:"",onClick:t[2]||(t[2]=a=>e.$emit("menu-click")),class:"action-btn"})])])}var ce=S(ne,[["render",de],["__scopeId","data-v-fd0afa3e"]]);const me=G({name:"GameMenu",props:{level:{type:Number,required:!0},difficulty:{type:Number,required:!0}},emits:["settings-click","next-level-click","retry-level-click","show-completed-click","close"]}),fe={class:"text-h6 text-weight-bold"},ve={class:"text-subtitle2 text-grey-7"};function pe(e,t,s,l,d,m){return o(),k(U,{class:"game-menu q-pa-md column items-start justify-center",flat:"",bordered:""},{default:y(()=>[i(V,{class:"q-pb-sm column"},{default:y(()=>[u("div",fe,"Level #"+p(e.level),1),u("div",ve,"Difficulty: "+p(e.difficulty),1)]),_:1}),i(I,{spaced:""}),i(V,{class:"full-width q-gutter-sm"},{default:y(()=>[i(v,{label:"Settings",icon:"settings",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[0]||(t[0]=a=>e.$emit("settings-click"))}),i(v,{label:"Next Level",icon:"play_arrow",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[1]||(t[1]=a=>e.$emit("next-level-click"))}),i(v,{label:"Retry Level",icon:"refresh",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[2]||(t[2]=a=>e.$emit("retry-level-click"))}),i(v,{label:"Completed Games",icon:"check_circle",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[3]||(t[3]=a=>e.$emit("show-completed-click"))})]),_:1}),i(I,{spaced:""}),i(V,{class:"full-width q-gutter-sm",align:"right"},{default:y(()=>[i(v,{label:"Close",unelevated:"",rounded:"",onClick:t[4]||(t[4]=a=>e.$emit("close"))})]),_:1})]),_:1})}var ge=S(me,[["render",pe],["__scopeId","data-v-1d15204c"]]);const he=1,Ce=9;function q(e){return Math.min(he+Math.floor((e-1)/5),Ce)}let C;const g=F({board:void 0,solution:void 0,userValues:[],moveMemories:[],isGenerating:!0,elapsedSeconds:0,selectedCellIndex:void 0,level:0,difficulty:1,isSolved:!1,setSelectedCell(e){this.selectedCellIndex=e},setUserValue(e){if(!this.isSolved&&this.selectedCellIndex!==void 0){if(this.moveMemories.push({cellIndex:this.selectedCellIndex,oldValue:this.userValues[this.selectedCellIndex]}),this.userValues[this.selectedCellIndex]===e){this.userValues[this.selectedCellIndex]=0;return}this.userValues[this.selectedCellIndex]=e;for(let t=0;t<this.board.cellcount;t++){const s=this.solution.solution[t];if(this.userValues[t]!==s)return}this.isSolved=!0}},undoLastMove(){if(this.isSolved)return;const e=this.moveMemories.pop();!e||(this.userValues[e.cellIndex]=e.oldValue,this.selectedCellIndex=void 0)},resetLevel(){!this.solution||(this.userValues.length=this.solution.skeleton.length,this.solution.skeleton.forEach((e,t)=>this.userValues[t]=e),this.moveMemories.length=0,this.selectedCellIndex=void 0,this.isSolved=!1,this.resetTimer())},resetTimer(){C&&clearInterval(C),this.elapsedSeconds=0,C=setInterval(()=>{this.elapsedSeconds+=1},1e3)},stopTimer(){C&&clearInterval(C),C=void 0},generateGame(e){this.level=e,this.difficulty=q(e),this.isGenerating=!0,this.selectedCellIndex=void 0,w.postMessage({level:this.level,difficulty:this.difficulty})},importSaveGame(e){this.board=e.board,this.solution=e.solution,this.level=e.level,this.difficulty=q(this.level),this.userValues.length=e.userData.values.length,e.userData.values.forEach((t,s)=>this.userValues[s]=t),this.moveMemories.length=e.userData.moves.length,e.userData.moves.forEach((t,s)=>this.moveMemories[s]=t),this.selectedCellIndex=void 0,this.isSolved=!1,this.isGenerating=!1,this.resetTimer()},exportSaveGame(){return{board:this.board,solution:this.solution,userData:{values:[...this.userValues],moves:[...this.moveMemories]},level:this.level}},clear(){this.stopTimer(),w.terminate()}}),w=new Worker("/Gridlock/assets/boardWorker.81d38781.js",{type:"module"});w.onmessage=e=>{const t=e.data;if(t.error||!t.board||!t.solution){console.error("Board generation failed:",t.error);return}g.board=t.board,g.solution=t.solution,g.isGenerating=!1,g.resetLevel()};O(()=>g.isSolved,e=>{!e||g.stopTimer()});const ye=H("preference-store",{state:()=>({lastLevel:1,saveGame:void 0}),persist:!0});const be=G({name:"IndexPage",components:{GameBoard:re,GameKeyboard:ce,GameMenu:ge},setup(){return{GameManager:g,preferenceStore:ye()}},mounted(){this.preferenceStore.saveGame&&this.preferenceStore.saveGame.board&&this.preferenceStore.saveGame.board&&this.preferenceStore.saveGame.solution&&this.preferenceStore.saveGame.userData&&this.preferenceStore.saveGame.userData.moves&&this.preferenceStore.saveGame.userData.values&&this.preferenceStore.saveGame.level?this.GameManager.importSaveGame(this.preferenceStore.saveGame):this.GameManager.generateGame(this.preferenceStore.lastLevel)},unmounted(){this.GameManager.clear()},data(){return{menuVisible:!1}},methods:{onUndoClick(){this.GameManager.undoLastMove(),this.preferenceStore.saveGame=this.GameManager.exportSaveGame()},onNumberClick(e){this.GameManager.setUserValue(e.value),this.preferenceStore.saveGame=this.GameManager.exportSaveGame()},onRetryLevelClick(){const e=this.GameManager;_.create({title:"Retry Level",message:"Are you sure you want to retry this level? Your current progress will be lost.",persistent:!0,ok:{label:"Retry",color:"negative",unelevated:!0},cancel:{label:"Cancel",flat:!0}}).onOk(()=>{e.resetLevel(),this.preferenceStore.saveGame=this.GameManager.exportSaveGame(),this.closeMenu()})},onNextLevelClick(){_.create({title:"Next Level",message:"Are you ready to start the next level?",persistent:!0,ok:!0,cancel:!0}).onOk(()=>{this.GameManager.generateGame(this.GameManager.level+1),this.closeMenu()})},closeMenu(){this.menuVisible=!1},getStarClass(e){return e>=1&&e<=3?"yellow-star":e>=4&&e<=6?"blue-star":"red-star"}},watch:{"GameManager.isSolved"(e,t){!t&&e&&_.create({title:"Congratulations!",message:`You solved the level in ${this.elapsedTime}!`,ok:{label:"Ok",color:"primary",unelevated:!0},persistent:!0}).onOk(()=>{this.GameManager.generateGame(this.GameManager.level+1)})},"GameManager.isGenerating"(e,t){t&&!e&&(this.preferenceStore.lastLevel=this.GameManager.level,this.preferenceStore.saveGame=this.GameManager.exportSaveGame())}},computed:{elapsedTime(){if(this.GameManager.elapsedSeconds<=0)return"00:00";const e=Math.floor(this.GameManager.elapsedSeconds/60),t=this.GameManager.elapsedSeconds%60,s=String(e).padStart(2,"0"),l=String(t).padStart(2,"0");return`${s}:${l}`}}}),ke={key:0,class:"loading-overlay column items-center justify-center"},Ge={class:"q-mt-md"},Se={class:"text-h6 q-gutter-sm"};function Me(e,t,s,l,d,m){const a=M("game-board"),n=M("game-keyboard"),r=M("game-menu");return o(),k(X,{class:"column items-center justify-evenly"},{default:y(()=>[e.GameManager.isGenerating?(o(),c("div",ke,[i(Y,{size:"50px",color:"primary"}),u("div",Ge,[t[3]||(t[3]=u("p",null,"Generating Board...",-1)),u("p",null,"Level: "+p(e.GameManager.level),1),u("p",null,"Difficulty: "+p(e.GameManager.difficulty),1)])])):(o(),c(b,{key:1},[u("p",Se,[u("span",null,"Level: "+p(e.GameManager.level),1),u("span",null,[(o(!0),c(b,null,$((e.GameManager.difficulty-1)%3+1,f=>(o(),k(x,{key:f,name:"star",size:"18px",class:R(e.getStarClass(e.GameManager.difficulty))},null,8,["class"]))),128))]),u("span",null,p(e.elapsedTime),1)]),i(a,{board:e.GameManager.board,solution:e.GameManager.solution,selectedCell:e.GameManager.selectedCellIndex,"user-values":e.GameManager.userValues,onCellClick:t[0]||(t[0]=f=>e.GameManager.setSelectedCell(f.idx))},null,8,["board","solution","selectedCell","user-values"]),i(n,{size:e.GameManager.board.size,onNumberClick:e.onNumberClick,onUndoClick:e.onUndoClick,onMenuClick:t[1]||(t[1]=()=>e.menuVisible=!0)},null,8,["size","onNumberClick","onUndoClick"]),i(K,{modelValue:e.menuVisible,"onUpdate:modelValue":t[2]||(t[2]=f=>e.menuVisible=f),persistent:""},{default:y(()=>[i(r,{level:e.GameManager.level,difficulty:e.GameManager.difficulty,onClose:e.closeMenu,onRetryLevelClick:e.onRetryLevelClick,onNextLevelClick:e.onNextLevelClick},null,8,["level","difficulty","onClose","onRetryLevelClick","onNextLevelClick"])]),_:1},8,["modelValue"])],64))]),_:1})}var Ve=S(be,[["render",Me],["__scopeId","data-v-0d997e08"]]);export{Ve as default};
