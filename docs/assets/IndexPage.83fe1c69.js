import{a as E,M as P,N as Q,h as I,k as D,m as y,d as L,e as H,j,q as K,t as T,D as S,_ as G,F as o,O as m,K as v,P as R,E as _,L as d,Q as k,R as $,G as M,S as F,I as i,T as p,H as f,U as b,V,W as B,A as U,w as W,r as Y,X as z,Y as A,Z as X,$ as w}from"./index.c947fde5.js";const Z='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var J=E({name:"QSpinnerDots",props:P,setup(e){const{cSize:t,classes:s}=Q(e);return()=>I("svg",{class:s.value,fill:"currentColor",width:t.value,height:t.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:Z})}}),x=E({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:t}){const{proxy:{$q:s}}=j(),a=D(K,y);if(a===y)return console.error("QPage needs to be a deep child of QLayout"),y;if(D(T,y)===y)return console.error("QPage needs to be child of QPageContainer"),y;const c=L(()=>{const n=(a.header.space===!0?a.header.size:0)+(a.footer.space===!0?a.footer.size:0);if(typeof e.styleFn=="function"){const r=a.isContainer.value===!0?a.containerHeight.value:s.screen.height;return e.styleFn(n,r)}return{minHeight:a.isContainer.value===!0?a.containerHeight.value-n+"px":s.screen.height===0?n!==0?`calc(100vh - ${n}px)`:"100vh":s.screen.height-n+"px"}}),l=L(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>I("main",{class:l.value,style:c.value},H(t.default))}});const ee=S({name:"GameCell",emits:["click"],props:{originalValue:{type:Number,required:!0},userValue:{type:Number,required:!0},isWrong:{type:Boolean,default:!0},isSelected:{type:Boolean,default:!1},isRowStart:{type:Boolean,default:!1},isRowEnd:{type:Boolean,default:!1},isColStart:{type:Boolean,default:!1},isColEnd:{type:Boolean,default:!1}},computed:{isConstant(){return this.originalValue!==0},displayValue(){const e=this.originalValue>0?this.originalValue:this.userValue;return e>0?e.toString():""}}});function te(e,t,s,a,u,c){return o(),m("div",{class:R(["cell",{"row-start":e.isRowStart,"row-end":e.isRowEnd,"col-start":e.isColStart,"col-end":e.isColEnd,constant:e.isConstant,selected:e.isSelected,wrong:e.isWrong}]),onClick:t[0]||(t[0]=l=>e.$emit("click"))},v(e.displayValue),3)}var se=G(ee,[["render",te],["__scopeId","data-v-68f95463"]]);const le=S({name:"GameBoard",components:{GameCell:se},emits:["cell-click"],props:{board:{type:Object,required:!0},solution:{type:Object,required:!0},userValues:{type:Object,required:!0},selectedCell:{type:Number,default:void 0}},computed:{selectedCellRow(){if(this.selectedCell!==void 0)return Math.floor(this.selectedCell/this.board.size)+1},selectedCellCol(){if(this.selectedCell!==void 0)return this.selectedCell%this.board.size+1}},methods:{getCellIndex(e,t){return(t-1)*this.board.size+(e-1)},getSkeletonValue(e,t){const s=this.getCellIndex(e,t);return this.solution.skeleton[s]},getUserValue(e,t){const s=this.getCellIndex(e,t);return this.userValues[s]},getIsWrong(e,t){const s=this.getCellIndex(e,t);if(this.solution.skeleton[s]!==0||this.userValues[s]===0)return!1;const a=this.userValues[s],u=this.solution.solution[s];return a!==u},onClickCell(e,t){this.$emit("cell-click",{idx:this.getCellIndex(e,t)})},getCellSegmentFlags(e,t){const s=this.board.rows[t-1],a=this.board.columns[e-1];let u=!1,c=!1,l=!1,n=!1,r=0;for(const g of s)e-1===r&&(u=!0),r+=g-1,e-1===r&&(c=!0),r+=1;r=0;for(const g of a)t-1===r&&(l=!0),r+=g-1,t-1===r&&(n=!0),r+=1;return{isRowStart:u,isRowEnd:c,isColStart:l,isColEnd:n}}}}),ae={class:"flex column"},ie={class:"game-board"};function ne(e,t,s,a,u,c){const l=_("game-cell");return o(),m("div",ae,[d("div",ie,[(o(!0),m(k,null,$(e.board.size,n=>(o(),m("div",{key:n,class:"board-row"},[(o(!0),m(k,null,$(e.board.size,r=>(o(),M(l,F({key:r,originalValue:e.getSkeletonValue(r,n),userValue:e.getUserValue(r,n)},{ref_for:!0},e.getCellSegmentFlags(r,n),{onClick:()=>e.onClickCell(r,n),isSelected:r===e.selectedCellCol&&n===e.selectedCellRow,isWrong:e.getIsWrong(r,n)}),null,16,["originalValue","userValue","onClick","isSelected","isWrong"]))),128))]))),128))])])}var re=G(le,[["render",ne],["__scopeId","data-v-25f7d2a0"]]);const oe=S({name:"GameKeyboard",props:{size:{type:Number,required:!0}},emits:["number-click","undo-click","menu-click"],setup(e,{emit:t}){return{onNumberClick:a=>{t("number-click",{value:a,notesMode:!1})}}}}),ue={class:"game-keyboard column items-center justify-center q-pa-xs q-gutter-y-sm"},de={class:"row no-wrap q-gutter-xs justify-center"},ce={class:"q-gutter-x-sm justify-center q-ml-sm"};function me(e,t,s,a,u,c){return o(),m("div",ue,[d("div",de,[(o(!0),m(k,null,$(e.size,l=>(o(),M(p,{key:l,label:l,onClick:n=>e.onNumberClick(l),flat:"",dense:"",class:"number-btn"},null,8,["label","onClick"]))),128))]),d("div",ce,[i(p,{icon:"close",onClick:t[0]||(t[0]=l=>e.onNumberClick(0)),flat:"",dense:"",class:"action-btn"}),i(p,{icon:"undo",flat:"",dense:"",onClick:t[1]||(t[1]=l=>e.$emit("undo-click")),class:"action-btn"}),i(p,{icon:"menu",flat:"",dense:"",onClick:t[2]||(t[2]=l=>e.$emit("menu-click")),class:"action-btn"})])])}var fe=G(oe,[["render",me],["__scopeId","data-v-fd0afa3e"]]);const pe=S({name:"GameMenu",props:{level:{type:Number,required:!0},difficulty:{type:Number,required:!0}},emits:["settings-click","new-level-click","retry-level-click","show-completed-click","close"]}),ve={class:"text-h6 text-weight-bold"},ge={class:"text-subtitle2 text-grey-7"};function he(e,t,s,a,u,c){return o(),M(B,{class:"game-menu q-pa-md column items-start justify-center",flat:"",bordered:""},{default:f(()=>[i(b,{class:"q-pb-sm column"},{default:f(()=>[d("div",ve,"Level #"+v(e.level),1),d("div",ge,"Difficulty: "+v(e.difficulty),1)]),_:1}),i(V,{spaced:""}),i(b,{class:"full-width q-gutter-sm"},{default:f(()=>[i(p,{label:"Settings",icon:"settings",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[0]||(t[0]=l=>e.$emit("settings-click"))}),i(p,{label:"New Level",icon:"play_arrow",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[1]||(t[1]=l=>e.$emit("new-level-click"))}),i(p,{label:"Retry Level",icon:"refresh",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[2]||(t[2]=l=>e.$emit("retry-level-click"))}),i(p,{label:"Completed Games",icon:"check_circle",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[3]||(t[3]=l=>e.$emit("show-completed-click"))})]),_:1}),i(V,{spaced:""}),i(b,{class:"full-width q-gutter-sm",align:"right"},{default:f(()=>[i(p,{label:"Close",unelevated:"",rounded:"",onClick:t[4]||(t[4]=l=>e.$emit("close"))})]),_:1})]),_:1})}var ye=G(pe,[["render",he],["__scopeId","data-v-41b083eb"]]);let C;const h=U({board:void 0,solution:void 0,userValues:[],moveMemories:[],isGenerating:!0,elapsedSeconds:0,selectedCellIndex:void 0,seed:0,difficulty:1,isSolved:!1,setSelectedCell(e){this.selectedCellIndex=e},setUserValue(e){if(!this.isSolved&&this.selectedCellIndex!==void 0){if(this.moveMemories.push({cellIndex:this.selectedCellIndex,oldValue:this.userValues[this.selectedCellIndex]}),this.userValues[this.selectedCellIndex]===e){this.userValues[this.selectedCellIndex]=0;return}this.userValues[this.selectedCellIndex]=e;for(let t=0;t<this.board.cellcount;t++){const s=this.solution.solution[t];if(this.userValues[t]!==s)return}this.isSolved=!0}},undoLastMove(){if(this.isSolved)return;const e=this.moveMemories.pop();!e||(this.userValues[e.cellIndex]=e.oldValue,this.selectedCellIndex=void 0)},resetLevel(){!this.solution||(this.userValues.length=this.solution.skeleton.length,this.solution.skeleton.forEach((e,t)=>this.userValues[t]=e),this.moveMemories.length=0,this.selectedCellIndex=void 0,this.isSolved=!1,this.resetTimer())},resetTimer(){C&&clearInterval(C),this.elapsedSeconds=0,C=setInterval(()=>{this.elapsedSeconds+=1},1e3)},stopTimer(){C&&clearInterval(C),C=void 0},generateGame(e,t){this.seed=e,this.difficulty=t,this.isGenerating=!0,this.selectedCellIndex=void 0,q.postMessage({seed:this.seed,difficulty:this.difficulty})},importSaveGame(e){this.board=e.board,this.solution=e.solution,this.seed=e.seed,this.difficulty=e.difficulty,this.userValues.length=e.userData.values.length,e.userData.values.forEach((t,s)=>this.userValues[s]=t),this.moveMemories.length=e.userData.moves.length,e.userData.moves.forEach((t,s)=>this.moveMemories[s]=t),this.selectedCellIndex=void 0,this.isSolved=!1,this.isGenerating=!1,this.resetTimer()},exportSaveGame(){return{board:this.board,solution:this.solution,userData:{values:[...this.userValues],moves:[...this.moveMemories]},seed:this.seed,difficulty:this.difficulty}},clear(){this.stopTimer(),q.terminate()}}),q=new Worker("/Gridlock/assets/boardWorker.9d888d0c.js",{type:"module"});q.onmessage=e=>{const t=e.data;if(t.error||!t.board||!t.solution){console.error("Board generation failed:",t.error);return}h.board=t.board,h.solution=t.solution,h.isGenerating=!1,h.resetLevel()};W(()=>h.isSolved,e=>{!e||h.stopTimer()});const Ce=()=>!0;function be(e){const t={};return e.forEach(s=>{t[s]=Ce}),t}function N(){const{emit:e,proxy:t}=j(),s=Y(null);function a(){s.value.show()}function u(){s.value.hide()}function c(n){e("ok",n),u()}function l(){e("hide")}return Object.assign(t,{show:a,hide:u}),{dialogRef:s,onDialogHide:l,onDialogOK:c,onDialogCancel:u}}const O=["ok","hide"];N.emits=O;N.emitsObject=be(O);const ke=S({name:"DifficultySelectMenu",props:{initial:{type:Number,default:1}},emits:["ok","hide"],setup(){const{dialogRef:e,onDialogHide:t,onDialogOK:s,onDialogCancel:a}=N();return{dialogRef:e,onDialogHide:t,onOKClick:l=>{s(l)},onCancelClick:()=>{a()}}},computed:{options(){return[{value:1,label:"Very Easy",color:"yellow",stars:1},{value:2,label:"Very Easy",color:"yellow",stars:2},{value:3,label:"Very Easy",color:"yellow",stars:3},{value:4,label:"Easy",color:"blue",stars:1},{value:5,label:"Easy",color:"blue",stars:2},{value:6,label:"Easy",color:"blue",stars:3},{value:7,label:"Hard",color:"red",stars:1},{value:8,label:"Hard",color:"red",stars:2},{value:9,label:"Hard",color:"red",stars:3}]}}}),Se={class:"column justify-around"},Ge=["onClick"],$e={class:"row justify-center q-mb-xs"};function Me(e,t,s,a,u,c){return o(),M(z,{ref:"dialogRef",onHide:e.onDialogHide},{default:f(()=>[i(B,{class:"q-pa-md column items-center justify-center",style:{width:"400px"}},{default:f(()=>[i(b,{class:"text-center q-pb-sm"},{default:f(()=>[...t[0]||(t[0]=[d("div",{class:"text-h6 text-weight-bold"},"Select Difficulty",-1)])]),_:1}),i(V,{spaced:""}),i(b,{class:"full-width q-gutter-sm"},{default:f(()=>[d("div",Se,[(o(!0),m(k,null,$(e.options,l=>(o(),m("div",{key:l.value,class:R(["row items-center justify-start difficulty-option q-pa-xs q-gutter-x-md",{highlighted:l.value===e.initial}]),onClick:n=>e.onOKClick(l.value)},[d("span",null,v(l.label),1),d("span",$e,[(o(!0),m(k,null,$(l.stars,n=>(o(),m("span",{key:n,class:"star",style:A({color:l.color,fontSize:"1.5em"})},"\u2605",4))),128))])],10,Ge))),128))])]),_:1}),i(V,{spaced:""}),i(b,{class:"full-width q-gutter-sm"},{default:f(()=>[i(p,{label:"Cancel",color:"negative",flat:"",rounded:"",class:"full-width",onClick:e.onCancelClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var _e=G(ke,[["render",Me],["__scopeId","data-v-da6d386a"]]);const Ve=X("preference-store",{state:()=>({difficulty:1,lastSeed:1,saveGame:void 0}),persist:!0}),we=S({name:"IndexPage",components:{GameBoard:re,GameKeyboard:fe,GameMenu:ye},setup(){return{GameManager:h,preferenceStore:Ve()}},mounted(){this.preferenceStore.saveGame?this.GameManager.importSaveGame(this.preferenceStore.saveGame):this.GameManager.generateGame(this.preferenceStore.lastSeed,this.preferenceStore.difficulty)},unmounted(){this.GameManager.clear()},data(){return{menuVisible:!1}},methods:{onUndoClick(){this.GameManager.undoLastMove(),this.preferenceStore.saveGame=this.GameManager.exportSaveGame()},onNumberClick(e){this.GameManager.setUserValue(e.value),this.preferenceStore.saveGame=this.GameManager.exportSaveGame()},onRetryLevelClick(){const e=this.GameManager;w.create({title:"Retry Level",message:"Are you sure you want to retry this level? Your current progress will be lost.",persistent:!0,ok:{label:"Retry",color:"negative",unelevated:!0},cancel:{label:"Cancel",flat:!0}}).onOk(()=>{e.resetLevel(),this.preferenceStore.saveGame=this.GameManager.exportSaveGame(),this.closeMenu()})},async onNewLevelClick(){const e=await new Promise(t=>{var s;w.create({component:_e,componentProps:{initial:(s=this.GameManager.difficulty)!=null?s:1},persistent:!0}).onOk(a=>t(a))});e&&(this.GameManager.generateGame(this.GameManager.seed+1,e),this.closeMenu())},closeMenu(){this.menuVisible=!1}},watch:{"GameManager.isSolved"(e,t){!t&&e&&w.create({title:"Congratulations!",message:`You solved the level in ${this.elapsedTime}!`,ok:{label:"Ok",color:"primary",unelevated:!0},persistent:!0}).onOk(()=>{this.GameManager.generateGame(this.GameManager.seed+1,this.GameManager.difficulty)})},"GameManager.isGenerating"(e,t){t&&!e&&(this.preferenceStore.lastSeed=this.GameManager.seed,this.preferenceStore.difficulty=this.GameManager.difficulty,this.preferenceStore.saveGame=this.GameManager.exportSaveGame())}},computed:{elapsedTime(){if(this.GameManager.elapsedSeconds<=0)return"00:00";const e=Math.floor(this.GameManager.elapsedSeconds/60),t=this.GameManager.elapsedSeconds%60,s=String(e).padStart(2,"0"),a=String(t).padStart(2,"0");return`${s}:${a}`}}}),qe={key:0,class:"loading-overlay column items-center justify-center"},Ne={class:"q-mt-md"};function De(e,t,s,a,u,c){const l=_("game-board"),n=_("game-keyboard"),r=_("game-menu");return o(),M(x,{class:"column items-center justify-evenly"},{default:f(()=>[e.GameManager.isGenerating?(o(),m("div",qe,[i(J,{size:"50px",color:"primary"}),d("div",Ne,[t[3]||(t[3]=d("p",null,"Generating Board...",-1)),d("p",null,"Level: "+v(e.GameManager.seed),1),d("p",null,"Difficulty: "+v(e.GameManager.difficulty),1)])])):(o(),m(k,{key:1},[d("p",null,"Level: "+v(e.GameManager.seed)+", difficulty "+v(e.GameManager.difficulty)+", "+v(e.elapsedTime),1),i(l,{ref:"gameBoard",board:e.GameManager.board,solution:e.GameManager.solution,selectedCell:e.GameManager.selectedCellIndex,"user-values":e.GameManager.userValues,onCellClick:t[0]||(t[0]=g=>e.GameManager.setSelectedCell(g.idx))},null,8,["board","solution","selectedCell","user-values"]),i(n,{size:e.GameManager.board.size,onNumberClick:e.onNumberClick,onUndoClick:e.onUndoClick,onMenuClick:t[1]||(t[1]=()=>e.menuVisible=!0)},null,8,["size","onNumberClick","onUndoClick"]),i(z,{modelValue:e.menuVisible,"onUpdate:modelValue":t[2]||(t[2]=g=>e.menuVisible=g),persistent:""},{default:f(()=>[i(r,{level:e.GameManager.seed,difficulty:e.GameManager.difficulty,onClose:e.closeMenu,onRetryLevelClick:e.onRetryLevelClick,onNewLevelClick:e.onNewLevelClick},null,8,["level","difficulty","onClose","onRetryLevelClick","onNewLevelClick"])]),_:1},8,["modelValue"])],64))]),_:1})}var Ee=G(we,[["render",De]]);export{Ee as default};
