import{a as R,M as F,N as K,h as p,O as H,P as Y,Q as J,R as X,d as y,S as Z,j as O,T as V,U as ee,V as te,W as le,k as Q,m as k,e as se,q as ae,t as re,D as _,_ as $,F as u,X as v,K as b,Y as ie,E as q,L as m,Z as G,$ as w,G as M,a0 as ne,I as o,a1 as h,H as g,a2 as I,a3 as j,a4 as oe,A as ue,w as ce,a5 as de,a6 as B,J as P,a7 as fe}from"./index.9f4f363f.js";const me='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>';var ve=R({name:"QSpinnerDots",props:F,setup(e){const{cSize:t,classes:s}=K(e);return()=>p("svg",{class:s.value,fill:"currentColor",width:t.value,height:t.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:me})}});const he={xs:8,sm:10,md:14,lg:20,xl:24};var L=R({name:"QChip",props:{...H,...Y,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:t,emit:s}){const{proxy:{$q:a}}=O(),c=J(e,a),d=X(e,he),i=y(()=>e.selected===!0||e.icon!==void 0),l=y(()=>e.selected===!0?e.iconSelected||a.iconSet.chip.selected:e.icon),r=y(()=>e.iconRemove||a.iconSet.chip.remove),f=y(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),T=y(()=>{const n=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(n?` text-${n} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(f.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(c.value===!0?" q-chip--dark q-dark":"")}),A=y(()=>{const n=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},N={...n,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||a.lang.label.remove};return{chip:n,remove:N}});function U(n){n.keyCode===13&&z(n)}function z(n){e.disable||(s("update:selected",!e.selected),s("click",n))}function D(n){(n.keyCode===void 0||n.keyCode===13)&&(le(n),e.disable===!1&&(s("update:modelValue",!1),s("remove")))}function W(){const n=[];f.value===!0&&n.push(p("div",{class:"q-focus-helper"})),i.value===!0&&n.push(p(V,{class:"q-chip__icon q-chip__icon--left",name:l.value}));const N=e.label!==void 0?[p("div",{class:"ellipsis"},[e.label])]:void 0;return n.push(p("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},ee(t.default,N))),e.iconRight&&n.push(p(V,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&n.push(p(V,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:r.value,...A.value.remove,onClick:D,onKeyup:D})),n}return()=>{if(e.modelValue===!1)return;const n={class:T.value,style:d.value};return f.value===!0&&Object.assign(n,A.value.chip,{onClick:z,onKeyup:U}),Z("div",n,W(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[te,e.ripple]])}}}),ge=R({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:t}){const{proxy:{$q:s}}=O(),a=Q(ae,k);if(a===k)return console.error("QPage needs to be a deep child of QLayout"),k;if(Q(re,k)===k)return console.error("QPage needs to be child of QPageContainer"),k;const d=y(()=>{const l=(a.header.space===!0?a.header.size:0)+(a.footer.space===!0?a.footer.size:0);if(typeof e.styleFn=="function"){const r=a.isContainer.value===!0?a.containerHeight.value:s.screen.height;return e.styleFn(l,r)}return{minHeight:a.isContainer.value===!0?a.containerHeight.value-l+"px":s.screen.height===0?l!==0?`calc(100vh - ${l}px)`:"100vh":s.screen.height-l+"px"}}),i=y(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>p("main",{class:i.value,style:d.value},se(t.default))}});const pe=_({name:"GameCell",emits:["click"],props:{originalValue:{type:Number,required:!0},userValue:{type:Number,required:!0},isWrong:{type:Boolean,default:!0},isSelected:{type:Boolean,default:!1},isRowStart:{type:Boolean,default:!1},isRowEnd:{type:Boolean,default:!1},isColStart:{type:Boolean,default:!1},isColEnd:{type:Boolean,default:!1}},computed:{isConstant(){return this.originalValue!==0},displayValue(){const e=this.originalValue>0?this.originalValue:this.userValue;return e>0?e.toString():""}}});function ye(e,t,s,a,c,d){return u(),v("div",{class:ie(["cell",{"row-start":e.isRowStart,"row-end":e.isRowEnd,"col-start":e.isColStart,"col-end":e.isColEnd,constant:e.isConstant,selected:e.isSelected,wrong:e.isWrong}]),onClick:t[0]||(t[0]=i=>e.$emit("click"))},b(e.displayValue),3)}var be=$(pe,[["render",ye],["__scopeId","data-v-68f95463"]]);const Ce=_({name:"GameBoard",components:{GameCell:be},emits:["cell-click"],props:{board:{type:Object,required:!0},solution:{type:Object,required:!0},userValues:{type:Object,required:!0},selectedCell:{type:Number,default:void 0}},computed:{selectedCellRow(){if(this.selectedCell!==void 0)return Math.floor(this.selectedCell/this.board.size)+1},selectedCellCol(){if(this.selectedCell!==void 0)return this.selectedCell%this.board.size+1}},methods:{getCellIndex(e,t){return(t-1)*this.board.size+(e-1)},getSkeletonValue(e,t){const s=this.getCellIndex(e,t);return this.solution.skeleton[s]},getUserValue(e,t){const s=this.getCellIndex(e,t);return this.userValues[s]},getIsWrong(e,t){const s=this.getCellIndex(e,t);if(this.solution.skeleton[s]!==0||this.userValues[s]===0)return!1;const a=this.userValues[s],c=this.solution.solution[s];return a!==c},onClickCell(e,t){this.$emit("cell-click",{idx:this.getCellIndex(e,t)})},getCellSegmentFlags(e,t){const s=this.board.rows[t-1],a=this.board.columns[e-1];let c=!1,d=!1,i=!1,l=!1,r=0;for(const f of s)e-1===r&&(c=!0),r+=f-1,e-1===r&&(d=!0),r+=1;r=0;for(const f of a)t-1===r&&(i=!0),r+=f-1,t-1===r&&(l=!0),r+=1;return{isRowStart:c,isRowEnd:d,isColStart:i,isColEnd:l}}}}),ke={class:"flex column"},Se={class:"game-board"};function Ge(e,t,s,a,c,d){const i=q("game-cell");return u(),v("div",ke,[m("div",Se,[(u(!0),v(G,null,w(e.board.size,l=>(u(),v("div",{key:l,class:"board-row"},[(u(!0),v(G,null,w(e.board.size,r=>(u(),M(i,ne({key:r,originalValue:e.getSkeletonValue(r,l),userValue:e.getUserValue(r,l)},{ref_for:!0},e.getCellSegmentFlags(r,l),{onClick:()=>e.onClickCell(r,l),isSelected:r===e.selectedCellCol&&l===e.selectedCellRow,isWrong:e.getIsWrong(r,l)}),null,16,["originalValue","userValue","onClick","isSelected","isWrong"]))),128))]))),128))])])}var Me=$(Ce,[["render",Ge],["__scopeId","data-v-25f7d2a0"]]);const _e=_({name:"GameKeyboard",props:{size:{type:Number,required:!0}},emits:["number-click","undo-click","menu-click"],setup(e,{emit:t}){return{onNumberClick:a=>{t("number-click",{value:a,notesMode:!1})}}}}),$e={class:"game-keyboard column items-center justify-center q-pa-xs q-gutter-y-sm"},Ve={class:"row no-wrap q-gutter-xs justify-center"},qe={class:"q-gutter-x-sm justify-center q-ml-sm"};function we(e,t,s,a,c,d){return u(),v("div",$e,[m("div",Ve,[(u(!0),v(G,null,w(e.size,i=>(u(),M(h,{key:i,label:i,onClick:l=>e.onNumberClick(i),flat:"",dense:"",class:"number-btn"},null,8,["label","onClick"]))),128))]),m("div",qe,[o(h,{icon:"close",onClick:t[0]||(t[0]=i=>e.onNumberClick(0)),flat:"",dense:"",class:"action-btn"}),o(h,{icon:"undo",flat:"",dense:"",onClick:t[1]||(t[1]=i=>e.$emit("undo-click")),class:"action-btn"}),o(h,{icon:"menu",flat:"",dense:"",onClick:t[2]||(t[2]=i=>e.$emit("menu-click")),class:"action-btn"})])])}var Ne=$(_e,[["render",we],["__scopeId","data-v-fd0afa3e"]]);const Ie=_({name:"GameMenu",props:{level:{type:Number,required:!0},difficulty:{type:Number,required:!0}},emits:["settings-click","next-level-click","retry-level-click","show-completed-click","close"]}),Be={class:"text-h6 text-weight-bold"},Le={class:"text-subtitle2 text-grey-7"};function xe(e,t,s,a,c,d){return u(),M(oe,{class:"game-menu q-pa-md column items-start justify-center",flat:"",bordered:""},{default:g(()=>[o(I,{class:"q-pb-sm column"},{default:g(()=>[m("div",Be,"Level #"+b(e.level),1),m("div",Le,"Difficulty: "+b(e.difficulty),1)]),_:1}),o(j,{spaced:""}),o(I,{class:"full-width q-gutter-sm"},{default:g(()=>[o(h,{label:"Settings",icon:"settings",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[0]||(t[0]=i=>e.$emit("settings-click"))}),o(h,{label:"Next Level",icon:"play_arrow",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[1]||(t[1]=i=>e.$emit("next-level-click"))}),o(h,{label:"Retry Level",icon:"refresh",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[2]||(t[2]=i=>e.$emit("retry-level-click"))}),o(h,{label:"Completed Games",icon:"check_circle",align:"left",class:"full-width",unelevated:"",rounded:"",onClick:t[3]||(t[3]=i=>e.$emit("show-completed-click"))})]),_:1}),o(j,{spaced:""}),o(I,{class:"full-width q-gutter-sm",align:"right"},{default:g(()=>[o(h,{label:"Close",unelevated:"",rounded:"",onClick:t[4]||(t[4]=i=>e.$emit("close"))})]),_:1})]),_:1})}var Re=$(Ie,[["render",xe],["__scopeId","data-v-1d15204c"]]);const Ae=1,ze=9;function E(e){return Math.min(Ae+Math.floor((e-1)/5),ze)}let S;const C=ue({board:void 0,solution:void 0,userValues:[],moveMemories:[],isGenerating:!0,elapsedSeconds:0,selectedCellIndex:void 0,level:0,difficulty:1,isSolved:!1,setSelectedCell(e){this.selectedCellIndex=e},setUserValue(e){if(!this.isSolved&&this.selectedCellIndex!==void 0&&this.solution.skeleton[this.selectedCellIndex]===0){if(this.moveMemories.push({cellIndex:this.selectedCellIndex,oldValue:this.userValues[this.selectedCellIndex]}),this.userValues[this.selectedCellIndex]===e){this.userValues[this.selectedCellIndex]=0;return}this.userValues[this.selectedCellIndex]=e;for(let t=0;t<this.board.cellcount;t++){const s=this.solution.solution[t];if(this.userValues[t]!==s)return}this.isSolved=!0}},undoLastMove(){if(this.isSolved)return;const e=this.moveMemories.pop();!e||(this.userValues[e.cellIndex]=e.oldValue,this.selectedCellIndex=void 0)},resetLevel(){!this.solution||(this.userValues.length=this.solution.skeleton.length,this.solution.skeleton.forEach((e,t)=>this.userValues[t]=e),this.moveMemories.length=0,this.selectedCellIndex=void 0,this.isSolved=!1,this.resetTimer())},resetTimer(e){S&&clearInterval(S),this.elapsedSeconds=e!=null?e:0,S=setInterval(()=>{this.elapsedSeconds+=1},1e3)},stopTimer(){S&&clearInterval(S),S=void 0},generateGame(e){this.level=e,this.difficulty=E(e),this.isGenerating=!0,this.selectedCellIndex=void 0,x.postMessage({level:this.level,difficulty:this.difficulty})},importSaveGame(e){this.board=e.board,this.solution=e.solution,this.level=e.level,this.difficulty=E(this.level),this.userValues.length=e.userData.values.length,e.userData.values.forEach((t,s)=>this.userValues[s]=t),this.moveMemories.length=e.userData.moves.length,e.userData.moves.forEach((t,s)=>this.moveMemories[s]=t),this.selectedCellIndex=void 0,this.isSolved=!1,this.isGenerating=!1,this.resetTimer(e.elapsedSeconds)},exportSaveGame(){return{board:this.board,solution:this.solution,userData:{values:[...this.userValues],moves:[...this.moveMemories]},level:this.level,elapsedSeconds:this.elapsedSeconds}},clear(){this.stopTimer(),x.terminate()}}),x=new Worker("/Gridlock/assets/boardWorker.81d38781.js",{type:"module"});x.onmessage=e=>{const t=e.data;if(t.error||!t.board||!t.solution){console.error("Board generation failed:",t.error);return}C.board=t.board,C.solution=t.solution,C.isGenerating=!1,C.resetLevel()};ce(()=>C.isSolved,e=>{!e||C.stopTimer()});function De(e){function t(l){return typeof l=="object"&&l!==null}function s(l){return Number.isSafeInteger(l)&&l>=0}function a(l){return!(!t(l)||!s(l.size)||!s(l.cellcount)||!Array.isArray(l.rows)||!l.rows.every(r=>Array.isArray(r)&&r.every(s))||!Array.isArray(l.columns)||!l.columns.every(r=>Array.isArray(r)&&r.every(s)))}function c(l){return!(!t(l)||!Array.isArray(l.solution)||!l.solution.every(s)||!Array.isArray(l.skeleton)||!l.skeleton.every(s))}function d(l){return!(!t(l)||!Array.isArray(l.values)||!l.values.every(s)||!Array.isArray(l.moves)||!l.moves.every(i))}function i(l){return!(!t(l)||!s(l.cellIndex)||!s(l.oldValue))}return!t(e)||!s(e.level)||(s(e.elapsedSeconds)||(e.elapsedSeconds=0),!a(e.board))||!c(e.solution)?!1:(d(e.userData)||(e.userData={values:[],moves:[]}),!0)}const Qe=de("preference-store",{state:()=>({saveGame:void 0}),persist:!0});const je=_({name:"IndexPage",components:{GameBoard:Me,GameKeyboard:Ne,GameMenu:Re},setup(){return{GameManager:C,preferenceStore:Qe()}},mounted(){if(!De(this.preferenceStore.saveGame)){console.log("invalid");return}this.GameManager.importSaveGame(this.preferenceStore.saveGame)},unmounted(){this.GameManager.clear()},data(){return{menuVisible:!1}},methods:{onUndoClick(){this.GameManager.undoLastMove(),this.preferenceStore.saveGame=this.GameManager.exportSaveGame()},onNumberClick(e){this.GameManager.setUserValue(e.value),this.preferenceStore.saveGame=this.GameManager.exportSaveGame()},onRetryLevelClick(){const e=this.GameManager;B.create({title:"Retry Level",message:"Are you sure you want to retry this level? Your current progress will be lost.",persistent:!0,ok:{label:"Retry",color:"negative",unelevated:!0},cancel:{label:"Cancel",flat:!0}}).onOk(()=>{e.resetLevel(),this.preferenceStore.saveGame=this.GameManager.exportSaveGame(),this.closeMenu()})},onNextLevelClick(){B.create({title:"Next Level",message:"Are you ready to start the next level?",persistent:!0,ok:!0,cancel:!0}).onOk(()=>{this.GameManager.generateGame(this.GameManager.level+1),this.closeMenu()})},closeMenu(){this.menuVisible=!1},getDifficultyChipColor(e){return e<=3?"amber":e<=6?"blue":"red"}},watch:{"GameManager.isSolved"(e,t){!t&&e&&B.create({title:"Congratulations!",message:`You solved the level in ${this.elapsedTime}!`,ok:{label:"Ok",color:"primary",unelevated:!0},persistent:!0}).onOk(()=>{this.GameManager.generateGame(this.GameManager.level+1)})},"GameManager.isGenerating"(e,t){t&&!e&&(this.preferenceStore.saveGame=this.GameManager.exportSaveGame())},"GameManager.elapsedSeconds"(){this.preferenceStore.saveGame=this.GameManager.exportSaveGame()}},computed:{elapsedTime(){if(this.GameManager.elapsedSeconds<=0)return"00:00";const e=Math.floor(this.GameManager.elapsedSeconds/60),t=this.GameManager.elapsedSeconds%60,s=String(e).padStart(2,"0"),a=String(t).padStart(2,"0");return`${s}:${a}`}}}),Pe={key:0,class:"loading-overlay column items-center justify-center"},Ee={class:"q-mt-md"};function Oe(e,t,s,a,c,d){const i=q("game-board"),l=q("game-keyboard"),r=q("game-menu");return u(),M(ge,{class:"column items-center justify-evenly"},{default:g(()=>[e.GameManager.isGenerating?(u(),v("div",Pe,[o(ve,{size:"50px",color:"primary"}),m("div",Ee,[t[3]||(t[3]=m("p",null,"Generating Board...",-1)),m("p",null,"Level: "+b(e.GameManager.level),1),m("p",null,"Difficulty: "+b(e.GameManager.difficulty),1)])])):(u(),v(G,{key:1},[o(L,{color:"primary","text-color":"white",icon:"military_tech"},{default:g(()=>[P(" Level "+b(e.GameManager.level),1)]),_:1}),o(i,{board:e.GameManager.board,solution:e.GameManager.solution,selectedCell:e.GameManager.selectedCellIndex,"user-values":e.GameManager.userValues,onCellClick:t[0]||(t[0]=f=>e.GameManager.setSelectedCell(f.idx))},null,8,["board","solution","selectedCell","user-values"]),m("p",null,[o(L,{color:e.getDifficultyChipColor(e.GameManager.difficulty),"text-color":"black",icon:"stars"},{default:g(()=>[(u(!0),v(G,null,w((e.GameManager.difficulty-1)%3+1,f=>(u(),M(V,{key:f,name:"star",size:"18px",class:"q-ml-xs"}))),128))]),_:1},8,["color"]),o(L,{color:"secondary","text-color":"white",icon:"schedule"},{default:g(()=>[P(b(e.elapsedTime),1)]),_:1})]),o(l,{size:e.GameManager.board.size,onNumberClick:e.onNumberClick,onUndoClick:e.onUndoClick,onMenuClick:t[1]||(t[1]=()=>e.menuVisible=!0)},null,8,["size","onNumberClick","onUndoClick"]),o(fe,{modelValue:e.menuVisible,"onUpdate:modelValue":t[2]||(t[2]=f=>e.menuVisible=f),persistent:""},{default:g(()=>[o(r,{level:e.GameManager.level,difficulty:e.GameManager.difficulty,onClose:e.closeMenu,onRetryLevelClick:e.onRetryLevelClick,onNextLevelClick:e.onNextLevelClick},null,8,["level","difficulty","onClose","onRetryLevelClick","onNextLevelClick"])]),_:1},8,["modelValue"])],64))]),_:1})}var Ue=$(je,[["render",Oe],["__scopeId","data-v-5eb1bf18"]]);export{Ue as default};
